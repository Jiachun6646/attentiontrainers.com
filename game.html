
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>快速计算训练</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background-color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            padding: 20px;
            overflow: hidden;
        }
        
        .game-container {
            width: 100%;
            max-width: 600px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            color: #333;
            margin-bottom: 20px;
            font-size: calc(24px + 1vw);
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            font-size: calc(16px + 0.5vw);
        }
        
        .problem {
            font-size: calc(32px + 2vw);
            margin-bottom: 30px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .answer-input {
            font-size: calc(20px + 1vw);
            padding: 10px 15px;
            width: 100%;
            max-width: 200px;
            border: 2px solid #ccc;
            border-radius: 5px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .answer-input:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        .buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        button {
            padding: 10px 20px;
            font-size: calc(16px + 0.5vw);
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #388E3C;
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .result {
            font-size: calc(18px + 0.5vw);
            margin-bottom: 20px;
            min-height: 30px;
        }
        
        .correct {
            color: #4CAF50;
        }
        
        .incorrect {
            color: #F44336;
        }
        
        .settings {
            margin-top: 20px;
            text-align: left;
            width: 100%;
        }
        
        .settings h3 {
            margin-bottom: 10px;
            font-size: calc(18px + 0.5vw);
        }
        
        .setting-group {
            margin-bottom: 15px;
        }
        
        .setting-label {
            display: block;
            margin-bottom: 5px;
            font-size: calc(14px + 0.3vw);
        }
        
        select {
            padding: 8px;
            font-size: calc(14px + 0.3vw);
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        
        .countdown {
            font-size: calc(24px + 1vw);
            color: #F44336;
            margin-bottom: 10px;
            min-height: 40px;
        }
        
        .game-over {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .summary {
            margin: 20px 0;
            font-size: calc(16px + 0.5vw);
            text-align: left;
            width: 100%;
        }
        
        .summary table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .summary td, .summary th {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        
        .summary th {
            background-color: #f2f2f2;
        }
        
        @media (max-width: 480px) {
            .buttons {
                flex-direction: column;
            }
            
            .game-container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>快速计算训练</h1>
        
        <div class="game-play">
            <div class="stats">
                <div>得分: <span id="score">0</span></div>
                <div>时间: <span id="timer">60</span>秒</div>
            </div>
            
            <div class="countdown" id="countdown"></div>
            
            <div class="problem" id="problem">准备开始...</div>
            
            <input type="number" class="answer-input" id="answer" placeholder="输入答案" autocomplete="off">
            
            <div class="result" id="result"></div>
            
            <div class="buttons">
                <button id="start-btn">开始游戏</button>
                <button id="submit-btn" disabled>提交</button>
                <button id="next-btn" disabled>下一题</button>
            </div>
            
            <div class="settings">
                <h3>游戏设置</h3>
                <div class="setting-group">
                    <label class="setting-label">难度级别:</label>
                    <select id="difficulty">
                        <option value="easy">简单 (个位数)</option>
                        <option value="medium" selected>中等 (两位数)</option>
                        <option value="hard">困难 (三位数)</option>
                    </select>
                </div>
                
                <div class="setting-group">
                    <label class="setting-label">运算类型:</label>
                    <select id="operation-type">
                        <option value="addition" selected>加法</option>
                        <option value="subtraction">减法</option>
                        <option value="multiplication">乘法</option>
                        <option value="division">除法</option>
                        <option value="mixed">混合运算</option>
                    </select>
                </div>
                
                <div class="setting-group">
                    <label class="setting-label">游戏时长:</label>
                    <select id="game-duration">
                        <option value="30">30秒</option>
                        <option value="60" selected>60秒</option>
                        <option value="120">120秒</option>
                        <option value="300">5分钟</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="game-over" id="game-over">
            <h2>游戏结束!</h2>
            <div class="summary" id="summary">
                <table>
                    <tr>
                        <th>总题数</th>
                        <th>正确数</th>
                        <th>错误数</th>
                        <th>正确率</th>
                        <th>平均用时</th>
                    </tr>
                    <tr>
                        <td id="total-problems">0</td>
                        <td id="correct-problems">0</td>
                        <td id="wrong-problems">0</td>
                        <td id="accuracy">0%</td>
                        <td id="avg-time">0秒</td>
                    </tr>
                </table>
            </div>
            <button id="play-again-btn">再玩一次</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 获取DOM元素
            const problemElement = document.getElementById('problem');
            const answerInput = document.getElementById('answer');
            const resultElement = document.getElementById('result');
            const scoreElement = document.getElementById('score');
            const timerElement = document.getElementById('timer');
            const countdownElement = document.getElementById('countdown');
            const startButton = document.getElementById('start-btn');
            const submitButton = document.getElementById('submit-btn');
            const nextButton = document.getElementById('next-btn');
            const difficultySelect = document.getElementById('difficulty');
            const operationTypeSelect = document.getElementById('operation-type');
            const gameDurationSelect = document.getElementById('game-duration');
            const gamePlayDiv = document.querySelector('.game-play');
            const gameOverDiv = document.getElementById('game-over');
            const playAgainButton = document.getElementById('play-again-btn');
            const totalProblemsElement = document.getElementById('total-problems');
            const correctProblemsElement = document.getElementById('correct-problems');
            const wrongProblemsElement = document.getElementById('wrong-problems');
            const accuracyElement = document.getElementById('accuracy');
            const avgTimeElement = document.getElementById('avg-time');
            
            // 游戏状态变量
            let currentProblem = {};
            let score = 0;
            let timeLeft = 60;
            let gameTimer;
            let isGameRunning = false;
            let problemStartTime;
            let gameStats = {
                totalProblems: 0,
                correctProblems: 0,
                wrongProblems: 0,
                totalTime: 0
            };
            
            // 生成不同难度的随机数
            function generateRandomNumber(difficulty) {
                switch(difficulty) {
                    case 'easy':
                        return Math.floor(Math.random() * 9) + 1; // 1-9
                    case 'medium':
                        return Math.floor(Math.random() * 90) + 10; // 10-99
                    case 'hard':
                        return Math.floor(Math.random() * 900) + 100; // 100-999
                    default:
                        return Math.floor(Math.random() * 90) + 10; // 默认中等难度
                }
            }
            
            // 生成新的计算题
            function generateProblem() {
                const difficulty = difficultySelect.value;
                const operationType = operationTypeSelect.value;
                
                let num1, num2, operation, answer;
                
                // 根据选择的运算类型生成问题
                if (operationType === 'mixed') {
                    // 混合运算随机选择一种
                    const operations = ['addition', 'subtraction', 'multiplication', 'division'];
                    operation = operations[Math.floor(Math.random() * operations.length)];
                } else {
                    operation = operationType;
                }
                
                switch(operation) {
                    case 'addition':
                        num1 = generateRandomNumber(difficulty);
                        num2 = generateRandomNumber(difficulty);
                        answer = num1 + num2;
                        currentProblem = {
                            text: `${num1} + ${num2} = ?`,
                            answer: answer
                        };
                        break;
                    case 'subtraction':
                        num1 = generateRandomNumber(difficulty);
                        // 确保结果为正数
                        if (difficulty === 'easy') {
                            num2 = Math.floor(Math.random() * num1) + 1;
                        } else if (difficulty === 'medium') {
                            num2 = Math.floor(Math.random() * Math.min(num1, 99)) + 1;
                        } else {
                            num2 = Math.floor(Math.random() * Math.min(num1, 999)) + 1;
                        }
                        answer = num1 - num2;
                        currentProblem = {
                            text: `${num1} - ${num2} = ?`,
                            answer: answer
                        };
                        break;
                    case 'multiplication':
                        // 乘法难度调整
                        if (difficulty === 'easy') {
                            num1 = Math.floor(Math.random() * 9) + 1; // 1-9
                            num2 = Math.floor(Math.random() * 9) + 1; // 1-9
                        } else if (difficulty === 'medium') {
                            num1 = Math.floor(Math.random() * 12) + 1; // 1-12
                            num2 = Math.floor(Math.random() * 9) + 1; // 1-9
                        } else {
                            num1 = Math.floor(Math.random() * 20) + 5; // 5-24
                            num2 = Math.floor(Math.random() * 15) + 5; // 5-19
                        }
                        answer = num1 * num2;
                        currentProblem = {
                            text: `${num1} × ${num2} = ?`,
                            answer: answer
                        };
                        break;
                    case 'division':
                        // 先确定答案和除数，然后计算被除数，确保整除
                        if (difficulty === 'easy') {
                            answer = Math.floor(Math.random() * 9) + 1; // 1-9
                            num2 = Math.floor(Math.random() * 9) + 1; // 1-9
                        } else if (difficulty === 'medium') {
                            answer = Math.floor(Math.random() * 20) + 1; // 1-20
                            num2 = Math.floor(Math.random() * 9) + 1; // 1-9
                        } else {
                            answer = Math.floor(Math.random() * 50) + 1; // 1-50
                            num2 = Math.floor(Math.random() * 20) + 1; // 1-20
                        }
                        num1 = answer * num2; // 确保能整除
                        currentProblem = {
                            text: `${num1} ÷ ${num2} = ?`,
                            answer: answer
                        };
                        break;
                }
                
                problemElement.textContent = currentProblem.text;
                answerInput.value = '';
                resultElement.textContent = '';
                resultElement.className = 'result';
                
                // 记录问题开始时间
                problemStartTime = Date.now();
                
                // 启用提交按钮，禁用下一题按钮
                submitButton.disabled = false;
                nextButton.disabled = true;
                
                // 自动聚焦到输入框
                answerInput.focus();
            }
            
            // 检查答案
            function checkAnswer() {
                if (!isGameRunning) return;
                
                const userAnswer = parseInt(answerInput.value);
                if (isNaN(userAnswer)) {
                    resultElement.textContent = '请输入有效数字';
                    resultElement.className = 'result incorrect';
                    return;
                }
                
                // 计算此题用时
                const problemTime = (Date.now() - problemStartTime) / 1000;
                gameStats.totalTime += problemTime;
                gameStats.totalProblems++;
                
                if (userAnswer === currentProblem.answer) {
                    resultElement.textContent = '正确!';
                    resultElement.className = 'result correct';
                    score += 10;
                    scoreElement.textContent = score;
                    gameStats.correctProblems++;
                } else {
                    resultElement.textContent = `错误! 正确答案是 ${currentProblem.answer}`;
                    resultElement.className = 'result incorrect';
                    gameStats.wrongProblems++;
                }
                
                // 禁用提交按钮，启用下一题按钮
                submitButton.disabled = true;
                nextButton.disabled = false;
                nextButton.focus();
            }
            
            // 更新计时器
            function updateTimer() {
                timeLeft--;
                timerElement.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    endGame();
                }
            }
            
            // 结束游戏
            function endGame() {
                clearInterval(gameTimer);
                isGameRunning = false;
                
                // 禁用所有游戏按钮
                submitButton.disabled = true;
                nextButton.disabled = true;
                
                // 显示游戏结果
                gamePlayDiv.style.display = 'none';
                gameOverDiv.style.display = 'flex';
                
                // 更新统计信息
                totalProblemsElement.textContent = gameStats.totalProblems;
                correctProblemsElement.textContent = gameStats.correctProblems;
                wrongProblemsElement.textContent = gameStats.wrongProblems;
                
                const accuracy = gameStats.totalProblems > 0 
                    ? ((gameStats.correctProblems / gameStats.totalProblems) * 100).toFixed(1) 
                    : '0.0';
                accuracyElement.textContent = `${accuracy}%`;
                
                const avgTime = gameStats.totalProblems > 0 
                    ? (gameStats.totalTime / gameStats.totalProblems).toFixed(1) 
                    : '0.0';
                avgTimeElement.textContent = `${avgTime}秒`;
            }
            
            // 开始游戏倒计时
            function startCountdown() {
                let count = 3;
                countdownElement.textContent = count;
                
                const countdownTimer = setInterval(() => {
                    count--;
                    
                    if (count > 0) {
                        countdownElement.textContent = count;
                    } else {
                        countdownElement.textContent = '开始!';
                        clearInterval(countdownTimer);
                        
                        // 启动游戏
                        setTimeout(() => {
                            countdownElement.textContent = '';
                            startGame();
                        }, 1000);
                    }
                }, 1000);
            }
            
            // 开始游戏
            function startGame() {
                // 重置游戏状态
                score = 0;
                scoreElement.textContent = score;
                timeLeft = parseInt(gameDurationSelect.value);
                timerElement.textContent = timeLeft;
                
                gameStats = {
                    totalProblems: 0,
                    correctProblems: 0,
                    wrongProblems: 0,
                    totalTime: 0
                };
                
                // 禁用设置
                difficultySelect.disabled = true;
                operationTypeSelect.disabled = true;
                gameDurationSelect.disabled = true;
                startButton.disabled = true;
                
                // 启动游戏计时器
                isGameRunning = true;
                gameTimer = setInterval(updateTimer, 1000);
                
                // 生成第一个问题
                generateProblem();
            }
            
            // 事件监听器
            startButton.addEventListener('click', function() {
                startCountdown();
            });
            
            submitButton.addEventListener('click', checkAnswer);
            
            // 按回车键提交答案
            answerInput.addEventListener('keypress', function(event) {
                if (event.key === 'Enter' && !submitButton.disabled) {
                    checkAnswer();
                }
            });
            
            nextButton.addEventListener('click', generateProblem);
            
            playAgainButton.addEventListener('click', function() {
                // 重置UI
                gameOverDiv.style.display = 'none';
                gamePlayDiv.style.display = 'block';
                
                // 启用设置
                difficultySelect.disabled = false;
                operationTypeSelect.disabled = false;
                gameDurationSelect.disabled = false;
                startButton.disabled = false;
                
                problemElement.textContent = '准备开始...';
                resultElement.textContent = '';
                answerInput.value = '';
            });
        });
    </script>
</body>
</html>
