<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数字消消乐 - AttentionTrainers</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: white;
        }
        #game-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            background-color: white;
        }
        #game-header {
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f0f0f0;
            border-bottom: 2px solid #ddd;
        }
        #score-container, #time-container, #level-container {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        #game-board {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            grid-template-rows: repeat(6, 1fr);
            gap: 10px;
            padding: 10px;
            background-color: white;
            overflow: hidden;
        }
        .tile {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: #4CAF50;
            color: white;
        }
        .tile.selected {
            transform: scale(0.9);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
            background-color: #2E7D32;
        }
        .tile.matched {
            animation: fadeOut 0.5s forwards;
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        #game-footer {
            padding: 10px;
            text-align: center;
            background-color: #f0f0f0;
            border-top: 2px solid #ddd;
        }
        button {
            padding: 8px 16px;
            font-size: 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background-color: #2196F3;
            color: white;
            margin: 0 5px;
        }
        button:hover {
            background-color: #0b7dda;
        }
        #start-screen, #game-over-screen {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.9);
            z-index: 10;
        }
        #game-over-screen {
            display: none;
        }
        h1 {
            font-size: 36px;
            margin-bottom: 20px;
            color: #333;
        }
        p {
            font-size: 18px;
            margin-bottom: 30px;
            color: #666;
            max-width: 80%;
            text-align: center;
        }
        .start-btn, .restart-btn {
            padding: 12px 24px;
            font-size: 20px;
            background-color: #4CAF50;
        }
        .start-btn:hover, .restart-btn:hover {
            background-color: #45a049;
        }
        #final-score {
            font-size: 24px;
            font-weight: bold;
            color: #E91E63;
            margin: 10px 0;
        }
        .progress-container {
            width: 100%;
            background-color: #ddd;
            height: 20px;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        #timer-bar {
            height: 100%;
            border-radius: 10px;
            background-color: #4CAF50;
            width: 100%;
            transition: width 1s linear;
        }
        @media (max-width: 600px) {
            #game-board {
                grid-template-columns: repeat(5, 1fr);
                grid-template-rows: repeat(7, 1fr);
            }
            .tile {
                font-size: 20px;
            }
            h1 {
                font-size: 24px;
            }
            p {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="game-header">
            <div id="score-container">
                <span>分数:</span>
                <span id="score">0</span>
            </div>
            <div id="level-container">
                <span>级别:</span>
                <span id="level">1</span>
            </div>
            <div id="time-container">
                <div class="progress-container">
                    <div id="timer-bar"></div>
                </div>
                <span id="time">60</span>秒
            </div>
        </div>
        <div id="game-board"></div>
        <div id="game-footer">
            <button id="hint-btn">提示</button>
            <button id="reset-btn">重置</button>
        </div>
    </div>

    <div id="start-screen">
        <h1>数字消消乐</h1>
        <p>相邻两个数字相加等于10时可以消除。选择两个相邻方块来消除它们。在时间结束前尽可能多地消除方块！</p>
        <button class="start-btn">开始游戏</button>
    </div>

    <div id="game-over-screen">
        <h1>游戏结束</h1>
        <p>你的最终得分是:</p>
        <div id="final-score">0</div>
        <button class="restart-btn">再来一次</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 游戏变量
            const gameBoard = document.getElementById('game-board');
            const scoreElement = document.getElementById('score');
            const timeElement = document.getElementById('time');
            const levelElement = document.getElementById('level');
            const timerBar = document.getElementById('timer-bar');
            const startScreen = document.getElementById('start-screen');
            const gameOverScreen = document.getElementById('game-over-screen');
            const finalScoreElement = document.getElementById('final-score');
            const hintBtn = document.getElementById('hint-btn');
            const resetBtn = document.getElementById('reset-btn');
            
            let boardSize = { rows: 6, cols: 6 };
            let board = [];
            let score = 0;
            let level = 1;
            let timeLeft = 60;
            let gameInterval;
            let selectedTiles = [];
            let matchTarget = 10;
            let hintTimeout;
            
            // 响应式调整网格尺寸
            function adjustGridSize() {
                if (window.innerWidth <= 600) {
                    boardSize = { rows: 7, cols: 5 };
                } else {
                    boardSize = { rows: 6, cols: 6 };
                }
                
                gameBoard.style.gridTemplateColumns = `repeat(${boardSize.cols}, 1fr)`;
                gameBoard.style.gridTemplateRows = `repeat(${boardSize.rows}, 1fr)`;
            }
            
            window.addEventListener('resize', () => {
                adjustGridSize();
                if (startScreen.style.display === 'none' && gameOverScreen.style.display === 'none') {
                    resetBoard();
                }
            });
            
            // 初始化游戏
            function initGame() {
                adjustGridSize();
                resetGame();
                
                document.querySelector('.start-btn').addEventListener('click', startGame);
                document.querySelector('.restart-btn').addEventListener('click', () => {
                    gameOverScreen.style.display = 'none';
                    resetGame();
                    startGame();
                });
                
                hintBtn.addEventListener('click', showHint);
                resetBtn.addEventListener('click', resetBoard);
            }
            
            // 重置游戏状态
            function resetGame() {
                score = 0;
                level = 1;
                timeLeft = 60;
                scoreElement.textContent = score;
                levelElement.textContent = level;
                timeElement.textContent = timeLeft;
                timerBar.style.width = '100%';
                clearInterval(gameInterval);
            }
            
            // 开始游戏
            function startGame() {
                startScreen.style.display = 'none';
                resetBoard();
                
                gameInterval = setInterval(() => {
                    timeLeft--;
                    timeElement.textContent = timeLeft;
                    timerBar.style.width = `${(timeLeft / 60) * 100}%`;
                    
                    if (timeLeft <= 10) {
                        timerBar.style.backgroundColor = '#FF5252';
                    } else {
                        timerBar.style.backgroundColor = '#4CAF50';
                    }
                    
                    if (timeLeft <= 0) {
                        endGame();
                    }
                }, 1000);
            }
            
            // 结束游戏
            function endGame() {
                clearInterval(gameInterval);
                gameOverScreen.style.display = 'flex';
                finalScoreElement.textContent = score;
            }
            
            // 生成游戏板
            function resetBoard() {
                gameBoard.innerHTML = '';
                board = [];
                selectedTiles = [];
                
                for (let row = 0; row < boardSize.rows; row++) {
                    board[row] = [];
                    for (let col = 0; col < boardSize.cols; col++) {
                        const value = Math.floor(Math.random() * 9) + 1;
                        board[row][col] = value;
                        
                        const tile = document.createElement('div');
                        tile.className = 'tile';
                        tile.textContent = value;
                        tile.dataset.row = row;
                        tile.dataset.col = col;
                        
                        // 根据数字设置不同颜色
                        const hue = (value * 30) % 360;
                        tile.style.backgroundColor = `hsl(${hue}, 70%, 50%)`;
                        
                        tile.addEventListener('click', () => selectTile(tile, row, col));
                        
                        gameBoard.appendChild(tile);
                    }
                }
                
                // 确保有效的选择
                if (!checkForPossibleMatches()) {
                    resetBoard();
                }
            }
            
            // 检查是否有可能的匹配
            function checkForPossibleMatches() {
                for (let row = 0; row < boardSize.rows; row++) {
                    for (let col = 0; col < boardSize.cols; col++) {
                        // 检查右边
                        if (col < boardSize.cols - 1) {
                            if (board[row][col] + board[row][col + 1] === matchTarget) {
                                return true;
                            }
                        }
                        
                        // 检查下方
                        if (row < boardSize.rows - 1) {
                            if (board[row][col] + board[row + 1][col] === matchTarget) {
                                return true;
                            }
                        }
                    }
                }
                return false;
            }
            
            // 查找可能的匹配
            function findMatch() {
                for (let row = 0; row < boardSize.rows; row++) {
                    for (let col = 0; col < boardSize.cols; col++) {
                        // 检查右边
                        if (col < boardSize.cols - 1) {
                            if (board[row][col] + board[row][col + 1] === matchTarget) {
                                return [
                                    { row, col },
                                    { row, col: col + 1 }
                                ];
                            }
                        }
                        
                        // 检查下方
                        if (row < boardSize.rows - 1) {
                            if (board[row][col] + board[row + 1][col] === matchTarget) {
                                return [
                                    { row, col },
                                    { row: row + 1, col }
                                ];
                            }
                        }
                    }
                }
                return null;
            }
            
            // 显示提示
            function showHint() {
                clearTimeout(hintTimeout);
                
                const match = findMatch();
                if (!match) {
                    resetBoard();
                    return;
                }
                
                const [pos1, pos2] = match;
                
                const tile1 = document.querySelector(`[data-row="${pos1.row}"][data-col="${pos1.col}"]`);
                const tile2 = document.querySelector(`[data-row="${pos2.row}"][data-col="${pos2.col}"]`);
                
                tile1.classList.add('hint');
                tile2.classList.add('hint');
                
                tile1.style.boxShadow = '0 0 15px rgba(33, 150, 243, 0.8)';
                tile2.style.boxShadow = '0 0 15px rgba(33, 150, 243, 0.8)';
                
                hintTimeout = setTimeout(() => {
                    tile1.classList.remove('hint');
                    tile2.classList.remove('hint');
                    tile1.style.boxShadow = '';
                    tile2.style.boxShadow = '';
                }, 1500);
            }
            
            // 选择方块
            function selectTile(tile, row, col) {
                // 如果已经选中，则取消选择
                if (selectedTiles.length === 1 && 
                    selectedTiles[0].row === row && 
                    selectedTiles[0].col === col) {
                    selectedTiles = [];
                    document.querySelectorAll('.tile.selected').forEach(t => {
                        t.classList.remove('selected');
                    });
                    return;
                }
                
                // 选择方块
                tile.classList.add('selected');
                selectedTiles.push({ row, col, element: tile });
                
                // 如果选择了两个方块，检查它们是否匹配
                if (selectedTiles.length === 2) {
                    const [first, second] = selectedTiles;
                    
                    // 检查是否相邻
                    const isAdjacent = 
                        (Math.abs(first.row - second.row) === 1 && first.col === second.col) ||
                        (Math.abs(first.col - second.col) === 1 && first.row === second.row);
                    
                    // 检查数字之和是否等于目标值
                    const sum = board[first.row][first.col] + board[second.row][second.col];
                    
                    if (isAdjacent && sum === matchTarget) {
                        // 匹配成功
                        first.element.classList.add('matched');
                        second.element.classList.add('matched');
                        
                        // 更新分数
                        score += level * 10;
                        scoreElement.textContent = score;
                        
                        // 根据分数提高等级
                        if (score >= level * 100) {
                            level++;
                            levelElement.textContent = level;
                            timeLeft = Math.min(timeLeft + 10, 60);
                            timeElement.textContent = timeLeft;
                        }
                        
                        // 延迟后替换匹配的方块
                        setTimeout(() => {
                            replaceTiles();
                        }, 500);
                    } else {
                        // 匹配失败，取消选择
                        setTimeout(() => {
                            selectedTiles.forEach(({ element }) => {
                                element.classList.remove('selected');
                            });
                            selectedTiles = [];
                        }, 500);
                    }
                }
            }
            
            // 替换已匹配的方块
            function replaceTiles() {
                selectedTiles.forEach(({ row, col, element }) => {
                    // 生成新的数字
                    const newValue = Math.floor(Math.random() * 9) + 1;
                    board[row][col] = newValue;
                    
                    // 更新方块
                    element.textContent = newValue;
                    element.classList.remove('selected', 'matched');
                    
                    // 更新颜色
                    const hue = (newValue * 30) % 360;
                    element.style.backgroundColor = `hsl(${hue}, 70%, 50%)`;
                });
                
                selectedTiles = [];
                
                // 检查是否还有可能的匹配
                if (!checkForPossibleMatches()) {
                    resetBoard();
                }
            }
            
            // 初始化游戏
            initGame();
        });
    </script>
</body>
</html>
